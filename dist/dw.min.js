/*!
* DW Utilities (JS)
* @version 0.6.0
* @link https://darkwave.ltd
* Copyright 2016-2023 HXGF (Jonathan Youngblood)
* Licensed under MIT (https://github.com/hxgf/dw-utilities-js/blob/master/LICENSE.md)
*/
var dw={api_request:function(e){var t=e.data?e.data:{},o=new XMLHttpRequest;o.open("POST",e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onload=function(){if(this.status>=200&&this.status<400){if(!e.callback)return e.debug&&console.log(JSON.parse(this.response)),this.response;e.callback(JSON.parse(this.response))}},o.onerror=function(){};var n="";for(key in t)n+=encodeURIComponent(key)+"="+encodeURIComponent(t[key])+"&";return o.send(n)},serialize:function(e){document.querySelectorAll(".quill-editor").forEach((function(e,t){document.querySelector('input[name="'+e.getAttribute("data-target")+'"]').value=e.querySelector(".ql-editor").innerHTML}));for(var t=[],o=0;o<e.elements.length;o++){var n=e.elements[o];if(n.name&&!n.disabled&&"file"!==n.type&&"reset"!==n.type&&"submit"!==n.type&&"button"!==n.type)if("select-multiple"===n.type||"select"===n.type)for(var a=0;a<n.options.length;a++)n.options[a].selected&&t.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.options[a].value));else("checkbox"!==n.type&&"radio"!==n.type||n.checked)&&t.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.value))}return t.join("&")},form_validate:function(e){for(var t=document.querySelectorAll(".required input, .required textarea, .required select"),o=!0,n=0;n<t.length;n++){var a=t[n];a.value||(a.classList.add("is-invalid"),a.nextElementSibling.innerHTML="Required",o=!1)}o?e():(document.body.classList.remove("working"),dw.modal({title:'<svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg><br />Incomplete Data',content:'<span class="text-muted">Please add missing information to<br /> any <span class="text-danger">required</span> fields and try again.</span>',format:"small",theme:"danger",centered:!0,modal_title_extra:"text-center w-100 pt-2 fs-2",modal_body_extra:"text-center",buttons:[{label:"OK",color:"danger",class_extra:"w-75 mx-auto mb-3",close_modal:!0}]}))},formbody_encode:function(e){return Object.entries(e).map((([e,t])=>e+"="+t)).join("&")},cookie_set:function(e,t,o=365){var n="";if(o){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3),n="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"},cookie_get:function(e){let t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()},cookie_delete:function(e){document.cookie=e+"=; Max-Age=0"},cookie_parse:function(e){return e.split(";").map((e=>e.split("="))).reduce(((e,t)=>(e[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim()),e)),{})},jwt_parse:function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)},api_xhr:function(e){e.data=e.data||{},e.authenticated&&this.cookie_get("auth_token")&&(e.data.auth_token=this.cookie_get("auth_token"));var t=new XMLHttpRequest;return t.open("POST",e.url,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.onload=function(){if(this.status>=200&&this.status<400){if(!e.callback)return e.debug&&console.log(JSON.parse(this.response)),this.response;e.callback(JSON.parse(this.response))}else alert(`Request error: ${this.response}`)},t.onerror=function(){alert(`Network error: ${this.response}`)},t.send(this.formbody_encode(e.data))},api_fetch:function(e){e.authenticated&&this.cookie_get("auth_token")&&(e.data.auth_token=this.cookie_get("auth_token"));let t={method:e.method?e.method:"POST",headers:{"Content-type":e.json?"application/json":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}};if("GET"===e.method){let t=new URLSearchParams(e.data).toString();e.url=e.url+"?"+t}else t.body=e.json?JSON.stringify(e.data):this.formbody_encode(e.data);return fetch(e.url,t).then((e=>e.json())).catch((e=>{alert(`Network error: ${e}`),console.log(e)}))},modal:function(e){var t=e.modal_id?e.modal_id:"modal"+Math.random().toString(36).slice(2,7),o="";if(e.buttons){dw.button_callbacks={};for(var n=0;n<e.buttons.length;n++)e.buttons[n].callback&&(dw.button_callbacks[n]=e.buttons[n].callback),o+=`<button type="button" class="btn ${e.buttons[n].color?`btn-${e.buttons[n].color}`:""} ${e.buttons[n].class_extra}" ${e.buttons[n].close_modal?'data-bs-dismiss="modal"':""} ${e.buttons[n].callback?`onclick="dw.button_callbacks[${n}]('${t}')"`:""}>${e.buttons[n].label}</button>`}var a=`\n    <div class="modal ${e.blur?"modal-blur":""} ${e.fade?"fade":""}" id="${t}" tabindex="-1" role="dialog" aria-hidden="true">\n      <div class="modal-dialog ${"small"==e.format?"modal-sm":""} ${"large"==e.format?"modal-lg":""} ${"full-width"==e.format?"modal-full-width":""} ${e.centered?"modal-dialog-centered":""} ${e.scrollable?"modal-dialog-scrollable":""} ${e.modal_dialog_extra?e.modal_dialog_extra:""}" role="document">\n        <div class="modal-content ${e.modal_content_extra?e.modal_content_extra:""}">\n        ${e.theme?`<div class="modal-status bg-${e.theme}"></div>`:""}\n        ${"small"==e.format?`\n          ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n        `:"\n          "+(e.title?`\n            <div class="modal-header ${e.modal_header_extra?e.modal_header_extra:""}">\n              <div class="modal-title ${e.modal_title_extra?e.modal_title_extra:""}">${e.title}</div>\n              ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n            </div>`:`\n              ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n          `)}\n          <div class="modal-body ${e.modal_body_extra?e.modal_body_extra:""}">\n          ${e.form?'<form action="javascript:void(0);">':""}\n            ${"small"==e.format?`\n              ${e.title?`<div class="modal-title ${e.modal_title_extra?e.modal_title_extra:""}">${e.title}</div>`:""}            \n              <div>${e.content}</div>\n            `:e.content}\n          ${e.form?"</form>":""}\n          </div>\n          <div class="modal-footer ${e.modal_footer_extra?e.modal_footer_extra:""}">\n            ${o}\n          </div>\n        </div>\n      </div>\n    </div>\n    <a href="#" class="d-none" data-bs-toggle="modal" data-bs-target="#${t}"></a>\n    `;document.getElementById(t+"-group")&&document.getElementById(t+"-group").remove();var l=document.createElement("div");l.setAttribute("id",t+"-group"),document.body.appendChild(l),document.getElementById(t+"-group").innerHTML=a,document.querySelector('[data-bs-target="#'+t+'"]').click()},modal_destroy:function(e){document.getElementById(e+"-group")&&document.getElementById(e+"-group").remove()},validate_input:function(e){if(e.unique){var t={collection:e.unique.collection,field:e.unique.field,value:e.element.value};e.unique.exempt_id&&(t.exempt_id=e.unique.exempt_id),dw.api_request({url:"/dw/utility/validate-unique/",data:t,callback:function(t){t.error?dw.display_error(e.input,e.unique.error_message?e.unique.error_message:"Value must be unique"):dw.remove_error(e.input)}})}else e.required&&(e.element.value?dw.remove_error(e.input):dw.display_error(e.input,"Required"))},remove_error:function(e){document.querySelector('[data-validate="'+e+'"] .form-control').classList.remove("is-invalid"),document.querySelector('[data-validate="'+e+'"] .invalid-feedback').innerHTML=""},display_error:function(e,t){document.querySelector('[data-validate="'+e+'"] .form-control').classList.add("is-invalid"),document.querySelector('[data-validate="'+e+'"] .invalid-feedback').innerHTML=t},edit_form:function(){return{save:function(e){document.body.classList.add("working");var t=!!e.callback&&e.callback;e.redirect&&(t=function(t){window.location.href=e.redirect}),e.debug&&(t=function(e){document.body.classList.remove("working"),console.log(e)}),dw.form_validate((function(){dw.api_request({url:e.url,data:e.data,callback:t})}))},delete_confirm:function(e){document.querySelector('[data-container="delete"]').innerHTML=`\n        <div class='mb-2 fw-medium'>${e.message?e.message:"Are you sure?"}</div>\n        <button class='btn btn-danger' @click='delete_execute(${JSON.stringify(e)})'>Yes</button>\n        &nbsp; \n        <button class='btn' @click='delete_cancel(${JSON.stringify(e)})'>Cancel</button>`},delete_execute:function(e){document.body.classList.add("working");var t=!!e.callback&&e.callback;e.redirect&&(t=function(t){window.location.href=e.redirect}),e.debug&&(t=function(e){document.body.classList.remove("working"),console.log(e)}),dw.api_request({url:e.url,data:e.data,callback:t})},delete_cancel:function(e){document.querySelector('[data-container="delete"]').innerHTML=`<button class='btn btn-outline-danger' @click='delete_confirm(${JSON.stringify(e)})'>Delete</button>`}}}};