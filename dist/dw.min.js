/*!
* DW Utilities (JS)
* @version 0.7.2
* @link https://darkwave.ltd
* Copyright 2016-2023 HXGF (Jonathan Youngblood)
* Licensed under MIT (https://github.com/hxgf/dw-utilities-js/blob/master/LICENSE.md)
*/
var dw={api_request:function(e){var t=e.data?e.data:{},o=new XMLHttpRequest;o.open("POST",e.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onload=function(){if(this.status<=399){if(!e.callback)return e.debug&&console.log(JSON.parse(this.response)),this.response;e.callback(JSON.parse(this.response))}else{document.body.classList.remove("working");var t="Server Error";try{var o=JSON.parse(this.response);o.error_code&&(t+=` (${o.error_code})`),o.error_message&&(t+=` - ${o.error_message}`),console.log(o)}catch(e){t+=` (${this.status})`,console.log(this.response)}alert(t+"\nSee console for more details.")}},o.onerror=function(){};var a="";for(key in t)a+=encodeURIComponent(key)+"="+encodeURIComponent(t[key])+"&";return o.send(a)},serialize:function(e){document.querySelectorAll(".quill-editor").forEach((function(e,t){document.querySelector('input[name="'+e.getAttribute("data-target")+'"]').value=e.querySelector(".ql-editor").innerHTML}));for(var t=[],o=0;o<e.elements.length;o++){var a=e.elements[o];if(a.name&&!a.disabled&&"file"!==a.type&&"reset"!==a.type&&"submit"!==a.type&&"button"!==a.type)if("select-multiple"===a.type||"select"===a.type)for(var r=0;r<a.options.length;r++)a.options[r].selected&&t.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.options[r].value));else("checkbox"!==a.type&&"radio"!==a.type||a.checked)&&t.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.value))}return t.join("&")},form_validate:function(e){for(var t=!0,o=document.querySelectorAll("[data-validate]"),a=0;a<o.length;a++){var r=o[a],n=(d=r.querySelector("input")).getAttribute("x-on:blur");d.classList.contains("is-invalid")?t=!1:n&&n.includes("required:")&&(d.value||(dw.display_error(r.getAttribute("data-validate"),"Required"),t=!1))}var l=document.querySelectorAll(".required input, .required textarea, .required select");for(a=0;a<l.length;a++){var d;(d=l[a]).value?d.classList.contains("is-invalid")&&(d.classList.remove("is-invalid"),d.nextElementSibling.innerHTML="Required",t=!0):(d.classList.add("is-invalid"),d.nextElementSibling.innerHTML="Required",t=!1)}if(!t)var i="Errors Detected",s='Please correct any<br /> <span class="text-danger">error</span> fields and try again.';t?e():(document.body.classList.remove("working"),dw.modal({title:`<svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg><br />${i}`,content:`<span class="text-muted">${s}</span>`,format:"small",theme:"danger",centered:!0,modal_title_extra:"text-center w-100 pt-2 fs-2",modal_body_extra:"text-center",modal_footer_extra:"border-top-0 bg-transparent",buttons:[{label:"OK",color:"danger",class_extra:"w-75 mx-auto mb-3",close_modal:!0}]}))},formbody_encode:function(e){return Object.entries(e).map((([e,t])=>e+"="+t)).join("&")},cookie_set:function(e,t,o=365){var a="";if(o){var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),a="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"},cookie_get:function(e){let t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()},cookie_delete:function(e){document.cookie=e+"=; Max-Age=0"},cookie_parse:function(e){return e.split(";").map((e=>e.split("="))).reduce(((e,t)=>(e[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim()),e)),{})},jwt_parse:function(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)},modal:function(e){var t=e.modal_id?e.modal_id:"modal"+Math.random().toString(36).slice(2,7),o="";if(e.buttons){dw.button_callbacks={};for(var a=0;a<e.buttons.length;a++)e.buttons[a].callback&&(dw.button_callbacks[a]=e.buttons[a].callback),o+=`<button type="button" class="btn ${e.buttons[a].color?`btn-${e.buttons[a].color}`:""} ${e.buttons[a].class_extra?e.buttons[a].class_extra:""}" ${e.buttons[a].close_modal?'data-bs-dismiss="modal"':""} ${e.buttons[a].callback?`onclick="dw.button_callbacks[${a}]('${t}')"`:""}>${e.buttons[a].label}</button>`}var r=`\n    <div class="modal ${e.blur?"modal-blur":""} ${e.fade?"fade":""}" id="${t}" tabindex="-1" role="dialog" aria-hidden="true">\n      <div class="modal-dialog ${"small"==e.format?"modal-sm":""} ${"large"==e.format?"modal-lg":""} ${"full-width"==e.format?"modal-full-width":""} ${e.centered?"modal-dialog-centered":""} ${e.scrollable?"modal-dialog-scrollable":""} ${e.modal_dialog_extra?e.modal_dialog_extra:""}" role="document">\n        <div class="modal-content ${e.modal_content_extra?e.modal_content_extra:""}">\n        ${e.theme?`<div class="modal-status bg-${e.theme}"></div>`:""}\n        ${"small"==e.format?`\n          ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n        `:"\n          "+(e.title?`\n            <div class="modal-header ${e.modal_header_extra?e.modal_header_extra:""}">\n              <div class="modal-title ${e.modal_title_extra?e.modal_title_extra:""}">${e.title}</div>\n              ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n            </div>`:`\n              ${e.hide_x?"":'<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'}\n          `)}\n          <div class="modal-body ${e.modal_body_extra?e.modal_body_extra:""}">\n          ${e.form?'<form action="javascript:void(0);">':""}\n            ${"small"==e.format?`\n              ${e.title?`<div class="modal-title ${e.modal_title_extra?e.modal_title_extra:""}">${e.title}</div>`:""}            \n              ${e.content?`\n                <div>${e.content}</div>\n                `:""}\n            `:e.content}\n          ${e.form?"</form>":""}\n          </div>\n          <div class="modal-footer ${e.modal_footer_extra?e.modal_footer_extra:""}">\n            ${o}\n          </div>\n        </div>\n      </div>\n    </div>\n    <a href="#" class="d-none" data-bs-toggle="modal" data-bs-target="#${t}"></a>\n    `;document.getElementById(t+"-group")&&document.getElementById(t+"-group").remove();var n=document.createElement("div");n.setAttribute("id",t+"-group"),document.body.appendChild(n),document.getElementById(t+"-group").innerHTML=r,document.querySelector('[data-bs-target="#'+t+'"]').click()},modal_destroy:function(e){document.getElementById(e+"-group")&&document.getElementById(e+"-group").remove()},validate_input:function(e){dw.prevent_submit=!0;var t=!0;if(e.required&&(e.element.value?(dw.remove_error(e.input),dw.prevent_submit=!1):(dw.display_error(e.input,e.error_message?e.error_message:"Required"),dw.prevent_submit=!1,t=!1)),e.is_email&&t&&e.element.value&&(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e.element.value)?(dw.remove_error(e.input),dw.prevent_submit=!1):(dw.display_error(e.input,e.error_message?e.error_message:"Must be an email address"),dw.prevent_submit=!1,t=!1)),e.regex&&t&&e.element.value&&(e.regex.test(e.element.value)?(dw.remove_error(e.input),dw.prevent_submit=!1):(dw.display_error(e.input,e.error_message?e.error_message:"Error"),dw.prevent_submit=!1,t=!1)),e.unique&&t&&e.element.value){var o={collection:e.unique.collection,field:e.unique.field,value:e.element.value};e.unique.exempt_id&&(o.exempt_id=e.unique.exempt_id),dw.api_request({url:"/dw/utility/validate-unique/",data:o,callback:function(o){o.error?(dw.display_error(e.input,e.unique.error_message?e.unique.error_message:"Value must be unique"),dw.prevent_submit=!1,t=!1):(dw.remove_error(e.input),dw.prevent_submit=!1)}})}e.force_focus&&!t&&e.element.focus()},remove_error:function(e){document.querySelector('[data-validate="'+e+'"] .form-control').classList.remove("is-invalid"),document.querySelector('[data-validate="'+e+'"] .invalid-feedback').innerHTML=""},display_error:function(e,t){document.querySelector('[data-validate="'+e+'"] .form-control').classList.add("is-invalid"),document.querySelector('[data-validate="'+e+'"] .invalid-feedback').innerHTML=t},edit_form:function(){return{save:function(e){if(!dw.prevent_submit){document.body.classList.add("working");var t=!!e.callback&&e.callback;e.redirect&&(t=function(t){window.location.href=e.redirect}),e.debug&&(t=function(e){document.body.classList.remove("working"),console.log(e)}),dw.form_validate((function(){dw.api_request({url:e.url,data:e.data,callback:t})}))}},delete_confirm:function(e){document.querySelector('[data-container="delete"]').innerHTML=`\n        <div class='mb-2 fw-medium'>${e.message?e.message:"Are you sure?"}</div>\n        <button class='btn btn-danger' @click='delete_execute(${JSON.stringify(e)})'>Yes</button>\n        &nbsp; \n        <button class='btn' @click='delete_cancel(${JSON.stringify(e)})'>Cancel</button>`},delete_execute:function(e){document.body.classList.add("working");var t=!!e.callback&&e.callback;e.redirect&&(t=function(t){window.location.href=e.redirect}),e.debug&&(t=function(e){document.body.classList.remove("working"),console.log(e)}),dw.api_request({url:e.url,data:e.data,callback:t})},delete_cancel:function(e){document.querySelector('[data-container="delete"]').innerHTML=`<button class='btn btn-outline-danger' @click='delete_confirm(${JSON.stringify(e)})'>Delete</button>`}}},dz:[],upload_initialize:function(e,t={}){t.append_form=t.append_form?t.append_form:"form.edit-form",document.querySelector(`[data-dz-upload="${e}"] .preview-image img`)&&(t.preview_class_extra=document.querySelector(`[data-dz-upload="${e}"] .preview-image img`).classList.value);var o=t.dz_options?t.dz_options:{};o.acceptedFiles="acceptedFiles"in o?o.acceptedFiles:"image/jpeg,image/png,image/gif",o.maxFilesize="maxFilesize"in o?o.maxFilesize:10,o.url="url"in o?o.url:"/dw/utility/upload-file",o.clickable="clickable"in o?o.clickable:`[data-dz-upload="${e}"] .dropzone`,o.previewTemplate="previewTemplate"in o?o.previewTemplate:'<div class="dz-preview dz-file-preview"><img data-dz-thumbnail /><div class="dz-progress-container"><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div></div></div>',document.querySelector(`[data-dz-upload="${e}"] .dropzone`)&&(dw.dz[e]=new Dropzone(document.querySelector(`[data-dz-upload="${e}"] .dropzone`),o),dw.dz[e].on("error",(function(t,o){document.body.classList.remove("working"),dw.modal({title:'\n          <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg><br />        \n          Upload Error',content:`<span class="text-muted">${o}</span>`,format:"small",theme:"danger",modal_title_extra:"text-center w-100 pt-2 fs-2",modal_body_extra:"text-center",modal_footer_extra:"border-top-0 bg-transparent",buttons:[{label:"OK",color:"danger",class_extra:"w-75 mx-auto mb-3",close_modal:!0,callback:function(t){dw.dz[e].removeAllFiles(!0),document.querySelector(`[data-dz-upload="${e}"] .dz-message`).style.display=""}}]})})),dw.dz[e].on("thumbnail",(function(t,o){document.querySelector(`[data-dz-upload="${e}"] .dz-message`).style.display="none"})),dw.dz[e].on("uploadprogress",(function(t,o){100==o&&(document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="none",document.body.classList.add("working"))})),dw.dz[e].on("success",(function(o){var a=JSON.parse(o.xhr.responseText);if(a.error)document.body.classList.remove("working"),dw.modal({title:`\n            <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg><br />\n            ${a.error_title}`,content:`<span class="text-muted">${a.error_message}</span>`,format:"small",theme:"danger",modal_title_extra:"text-center w-100 pt-2 fs-2",modal_body_extra:"text-center",modal_footer_extra:"border-top-0 bg-transparent",buttons:[{label:"OK",color:"danger",class_extra:"w-75 mx-auto mb-3",close_modal:!0,callback:function(t){dw.dz[e].removeAllFiles(!0),document.querySelector(`[data-dz-upload="${e}"] .dz-message`).style.display=""}}]});else if(t.preview_html?(document.querySelector(`[data-dz-upload="${e}"] .preview-image`).innerHTML=t.preview_html,document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="none",document.body.classList.remove("working")):(document.querySelector(`[data-dz-upload="${e}"] .preview-image`).innerHTML=`<img class="new-upload ${t.preview_class_extra?t.preview_class_extra:""}" src="${a.preview_url}" >\n              <div class="upload-delete position-absolute top-0 end-0" data-new="true" data-filename="${a.filename}" data-id="${e}">      \n                <span onclick="dw.upload_delete('${e}', {'confirm': false, 'reset': true, 'append_form': '${t.append_form}'})" class="d-block cursor-pointer p-3">\n                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-danger bi bi-x-circle-fill" viewBox="0 0 16 16">\n                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>\n                  </svg>\n                </span>\n              </div>`,document.querySelector(`[data-dz-upload="${e}"] .preview-image .new-upload`).addEventListener("load",(function(){document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="none",this.style.display="",document.body.classList.remove("working"),document.querySelector(`[data-dz-upload="${e}"] .new-upload`).style.display="flex"}))),document.querySelector(`[data-dz-upload="${e}"]`).classList.remove("error"),document.querySelector('input[name="upload_'+e+'"]'))document.querySelector('input[name="upload_'+e+'"]').value=a.filename;else{var r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","upload_"+e),r.setAttribute("value",a.filename),document.querySelector(t.append_form).appendChild(r)}})))},upload_delete:function(e,t={}){t.append_form=t.append_form?t.append_form:"form.edit-form",t.message=t.message?t.message:"Are you sure you want<br /> to remove this photo?";var o=function(){if(t.reset){var o=document.querySelector('[data-new="true"]').getAttribute("data-filename");dw.dz[e].removeAllFiles(!0),document.querySelector(`[data-dz-upload="${e}"] .dz-message`).style.display="",document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="",document.querySelector(`[data-dz-upload="${e}"] .new-upload`).style.display="none",document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="",document.querySelector(`[data-dz-upload="${e}"] .preview-image`).innerHTML="",document.querySelector("input[name='upload_"+e+"']").remove(),dw.api_request({url:"/dw/utility/delete-upload",data:{filename:o}})}else if(document.querySelector(`[data-dz-upload="${e}"] .preview-image`).innerHTML="",document.querySelector(`[data-dz-upload="${e}"] .dropzone`).style.display="",document.querySelector('input[name="upload_'+e+'"]'))document.querySelector('input[name="upload_'+e+'"]').value="DELETE";else{var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","upload_"+e),a.setAttribute("value","DELETE"),document.querySelector(t.append_form).appendChild(a)}};t.confirm?dw.modal({title:`\n        <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 9v2m0 4v.01"></path><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path></svg><br />        \n        ${t.message}`,format:"small",theme:"danger",modal_title_extra:"text-center w-100 pt-2 fs-2 mb-0",modal_body_extra:"text-center",modal_footer_extra:"border-top-0 bg-transparent justify-content-center",buttons:[{label:"Yes",color:"danger",class_extra:"mb-3 px-3",close_modal:!0,callback:function(e){o()}},{label:"No",close_modal:!0,class_extra:"mb-3 px-3"}]}):o()}};